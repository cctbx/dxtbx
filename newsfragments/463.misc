Add initial pass of typing annotations and mypy fixes.
